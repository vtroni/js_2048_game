var t={};class e{static STATUS={idle:"idle",playing:"playing",win:"win",lose:"lose"};constructor(t=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]){this.status=e.STATUS.idle,this.score=0,this.initialState=t,this.state=t.map(t=>[...t])}getState(){return this.state}getScore(){return this.score}getStatus(){return this.status}moveLeft(){if(this.getStatus()!==e.STATUS.playing)return;let t=!1,s=this.state.map(e=>{let s=e.filter(t=>0!==t),i=[];for(let e=0;e<s.length;e++)if(s[e]===s[e+1]){let a=2*s[e];i.push(a),this.score+=a,e++,t=!0}else i.push(s[e]);for(;i.length<e.length;)i.push(0);return t||e.every((t,e)=>t===i[e])||(t=!0),i});return t&&(this.state=s,this.addCell(),this.setState(),this.checkStatus()),t}moveRight(){if(this.getStatus()!==e.STATUS.playing)return;let t=!1,s=this.state.map(e=>{let s=e.filter(t=>0!==t),i=[];for(let e=s.length-1;e>=0;e--)if(s[e]===s[e-1]){let a=2*s[e];i.unshift(a),this.score+=a,e--,t=!0}else i.unshift(s[e]);for(;i.length<e.length;)i.unshift(0);return t||e.every((t,e)=>t===i[e])||(t=!0),i});return t&&(this.state=s,this.addCell(),this.setState(),this.checkStatus()),t}moveUp(){if(this.getStatus()!==e.STATUS.playing)return;let t=!1,s=this.state.map(t=>[...t]);for(let e=0;e<this.state[0].length;e++){let i=[];for(let t=0;t<this.state.length;t++)0!==this.state[t][e]&&i.push(this.state[t][e]);let a=[];for(let e=0;e<i.length;e++)if(i[e]===i[e+1]){let s=2*i[e];a.push(s),this.score+=s,e++,t=!0}else a.push(i[e]);for(;a.length<this.state.length;)a.push(0);for(let i=0;i<this.state.length;i++)s[i][e]!==a[i]&&(s[i][e]=a[i],t=!0)}return t&&(this.state=s,this.addCell(),this.setState(),this.checkStatus()),t}moveDown(){if(this.getStatus()!==e.STATUS.playing)return;let t=!1,s=this.state.map(t=>[...t]);for(let e=0;e<this.state[0].length;e++){let i=[];for(let t=this.state.length-1;t>=0;t--)0!==this.state[t][e]&&i.push(this.state[t][e]);let a=[];for(let e=0;e<i.length;e++)if(i[e]===i[e+1]){let s=2*i[e];a.unshift(s),this.score+=s,e++,t=!0}else a.unshift(i[e]);for(;a.length<this.state.length;)a.unshift(0);for(let i=0;i<this.state.length;i++)s[i][e]!==a[i]&&(s[i][e]=a[i],t=!0)}return t&&(this.state=s,this.addCell(),this.setState(),this.checkStatus()),t}start(){this.status=e.STATUS.playing,this.state=this.initialState.map(t=>[...t]),this.addCell(),this.addCell(),this.setState()}restart(){this.score=0,this.status=e.STATUS.idle,this.state=this.initialState.map(t=>[...t]),this.setState()}addCell(){let t=[];for(let e=0;e<this.state.length;e++)for(let s=0;s<this.state[e].length;s++)0===this.state[e][s]&&t.push({r:e,c:s});if(0===t.length)return;let e=this.getRandomNumber(t.length),{r:s,c:i}=t[e],a=this.state.map(t=>[...t]);a[s][i]=this.getRandomCell(),this.state=a}setState(){let t=document.querySelectorAll(".field-cell"),e=this.state.flat();if(0!==t.length)for(let s=0;s<e.length;s++){let i=t[s],a=e[s];i&&(i.className="field-cell",a>0?(i.textContent=a,i.classList.add(`field-cell--${a}`)):i.textContent="")}}getRandomNumber(t){return Math.floor(Math.random()*t)}getRandomCell(){return .9>Math.random()?2:4}checkStatus(){let t=!1,s=!1;for(let t=0;t<this.state.length;t++)for(let s=0;s<this.state[t].length;s++)if(2048===this.state[t][s]){this.status=e.STATUS.win;return}for(let t=0;t<this.state.length;t++){for(let e=0;e<this.state[t].length-1;e++)if(this.state[t][e]===this.state[t][e+1]){s=!0;break}if(s)break}if(!s)for(let t=0;t<this.state.length-1;t++){for(let e=0;e<this.state[t].length;e++)if(this.state[t][e]===this.state[t+1][e]){s=!0;break}if(s)break}for(let e=0;e<this.state.length;e++){for(let s=0;s<this.state[e].length;s++)if(0===this.state[e][s]){t=!0;break}if(t)break}t||s||(this.status=e.STATUS.lose)}}const s=new(t=e),i=document.querySelector(".button"),a=document.querySelector(".message-start"),l=document.querySelector(".message-lose"),h=document.querySelector(".message-win"),r=document.querySelector(".game-score"),n=()=>r.textContent=s.score;i.addEventListener("click",()=>{i.classList.toggle("restart"),i.classList.toggle("start"),a.classList.toggle("hidden"),l.classList.add("hidden"),h.classList.add("hidden"),r.textContent=0,i.className.includes("start")&&(i.textContent="Start",s.restart()),i.className.includes("restart")&&(i.textContent="Restart",s.start()),document.addEventListener("keydown",u)});const o=()=>document.removeEventListener("keydown",u);function u(e){if(s.getStatus()===t.STATUS.playing){let t=!1;switch(e.key){case"ArrowLeft":t=s.moveLeft();break;case"ArrowRight":t=s.moveRight();break;case"ArrowUp":t=s.moveUp();break;case"ArrowDown":t=s.moveDown()}t&&n()}s.getStatus()===t.STATUS.lose&&(l.classList.remove("hidden"),o()),s.getStatus()===t.STATUS.win&&(h.classList.remove("hidden"),o()),e.preventDefault()}document.addEventListener("keydown",u);
//# sourceMappingURL=index.4a30ae7c.js.map
